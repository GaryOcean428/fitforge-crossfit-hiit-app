{
  "$schema": "https://schema.railpack.com",
  "provider": "node",
  "packages": {
    "node": "20"
  },
  "buildAptPackages": [
    "openjdk-17-jdk",
    "android-sdk",
    "gradle",
    "git",
    "curl",
    "unzip"
  ],
  "steps": {
    "install": {
      "commands": [
        "npm install"
      ],
      "caches": ["npm-cache"]
    },
    "setup-android": {
      "inputs": [{ "step": "install" }],
      "commands": [
        "export ANDROID_HOME=/usr/lib/android-sdk",
        "export PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools",
        "echo 'Android SDK setup complete'"
      ]
    },
    "build-android": {
      "inputs": [{ "step": "setup-android" }],
      "commands": [
        "npx react-native bundle --platform android --dev false --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle",
        "mkdir -p android/app/src/main/res/drawable",
        "echo 'Android bundle created'"
      ]
    }
  },
  "caches": {
    "npm-cache": {
      "directory": "/root/.npm",
      "type": "shared"
    },
    "gradle-cache": {
      "directory": "/root/.gradle",
      "type": "shared"
    }
  },
  "deploy": {
    "base": {
      "image": "ghcr.io/railwayapp/railpack-runtime:latest"
    },
    "aptPackages": ["openjdk-17-jre"],
    "startCommand": "echo 'React Native Android app built successfully. APK available for download.'",
    "variables": {
      "NODE_ENV": "production",
      "ANDROID_HOME": "/usr/lib/android-sdk"
    },
    "inputs": [
      {
        "step": "build-android",
        "include": [
          "android/app/src/main/assets",
          "android/app/src/main/res",
          "package.json",
          "README.md"
        ]
      }
    ]
  }
}

