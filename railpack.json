{
  "$schema": "https://schema.railpack.com",
  "provider": "python",
  "packages": {
    "python": "3.11"
  },
  "ignore": [
    "frontend/",
    "android/",
    "node_modules/",
    ".git/",
    "*.pyc",
    "__pycache__/",
    ".pytest_cache/",
    ".coverage",
    "*.log",
    ".env",
    ".venv/",
    "venv/",
    "docs/",
    "tests/",
    "*.md"
  ],
  "steps": {
    "install": {
      "commands": [
        "pip install --upgrade pip setuptools wheel",
        "cd backend/api && pip install --no-cache-dir -r requirements.txt"
      ],
      "timeout": 600
    },
    "build": {
      "commands": [
        "cd backend/api && python -m py_compile src/main.py",
        "cd backend/api && python -c 'import src.main; print(\"âœ… Flask app imports successfully\")'"
      ],
      "timeout": 120
    }
  },
  "deploy": {
    "startCommand": "cd backend/api && gunicorn src.main:app --bind 0.0.0.0:${PORT:-5000} --workers 4 --worker-class sync --timeout 120 --keep-alive 2 --max-requests 1000 --max-requests-jitter 100 --log-level info --access-logfile - --error-logfile -",
    "healthCheckPath": "/api/health",
    "healthCheckTimeout": 300,
    "healthCheckInterval": 30,
    "healthCheckRetries": 3,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3,
    "gracefulShutdownTimeout": 30
  },
  "environment": {
    "FLASK_ENV": "production",
    "PYTHONUNBUFFERED": "1",
    "PYTHONDONTWRITEBYTECODE": "1",
    "PYTHONPATH": "/app/backend/api:$PYTHONPATH"
  },
  "services": {
    "postgres": {
      "required": true,
      "version": "15"
    },
    "redis": {
      "required": true,
      "version": "7"
    }
  },
  "monitoring": {
    "healthCheck": {
      "enabled": true,
      "path": "/api/health",
      "interval": 30,
      "timeout": 10
    }
  }
}
